<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>M√°y b√°n ƒëi·ªÅu t·ªët ƒë·∫πp (Fly)</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#fbe8f6; --bg2:#efe6ff; --accent:#d77ff3; --accent-2:#ff9ac1; --paper:#fffaf0; --muted:#866a9a;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Nunito,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(145deg,var(--bg1),var(--bg2));-webkit-font-smoothing:antialiased;overflow:hidden}

  /* ---------- INTRO ---------- */
  .intro{
    position:fixed;inset:0;
    display:flex;align-items:center;justify-content:center;
    background:linear-gradient(135deg,var(--bg1),var(--bg2));
    z-index:500;transition:opacity 1s ease;opacity:1;
    flex-direction:column;overflow:hidden;
  }
  .intro.hidden{opacity:0;pointer-events:none;}
  .intro h1{
    font-size:28px;font-weight:800;color:#3a2a4a;letter-spacing:1px;
    animation:floatText 2.8s ease-in-out infinite alternate;margin-bottom:14px;
  }
  .intro-guide{
    font-size:1rem;color:#5a476b;opacity:0.8;
    margin:8px 0 24px;font-weight:400;text-align:center;
    animation:fadeIn 2s ease forwards;
  }
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px);}to{opacity:1;transform:translateY(0);}}
  .start-btn{
    background:linear-gradient(90deg,var(--accent),var(--accent-2));
    color:white;border:none;border-radius:30px;
    padding:10px 26px;font-size:16px;font-weight:700;
    cursor:pointer;box-shadow:0 6px 18px rgba(100,50,130,0.2);
    transition:transform .25s ease,box-shadow .25s ease;
  }
  .start-btn:hover{transform:translateY(-3px);box-shadow:0 10px 26px rgba(100,50,130,0.3);}
  @keyframes floatText{
    0%{transform:translateY(0);}
    100%{transform:translateY(-10px);}
  }
  .intro .sparkle{
    position:absolute;width:6px;height:6px;border-radius:50%;opacity:0.7;
    background:radial-gradient(circle,#fff,#ffcaff);
    animation:twinkle 2s ease-in-out infinite;
  }
  @keyframes twinkle{
    0%,100%{opacity:0.2;transform:scale(0.6);}
    50%{opacity:1;transform:scale(1);}
  }
  /* ---------------------------- */

  .scene{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:40px;opacity:0;transition:opacity 1s ease;}
  .scene.visible{opacity:1;}

  .container{width:100%;max-width:520px}

  .animated-bg{position:fixed;inset:0;z-index:0;background:linear-gradient(120deg,rgba(255,255,255,0.02),rgba(0,0,0,0.01));pointer-events:none}
  .stars{position:fixed;inset:0;z-index:0;pointer-events:none}

  .machine{position:relative;z-index:2;width:100%;border-radius:18px;padding:20px;background:linear-gradient(180deg,rgba(255,255,255,0.96),rgba(255,255,255,0.92));box-shadow:0 18px 40px rgba(80,50,90,0.06);border:1px solid rgba(255,255,255,0.6);overflow:visible}
  .machine::before{content:'';position:absolute;inset:-8px;border-radius:22px;background:linear-gradient(90deg,var(--accent),var(--accent-2));filter:blur(16px);opacity:0.45;z-index:-1}

  .top-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
  .title{font-weight:800;font-size:18px;color:#3a2a4a}
  .controls{display:flex;gap:10px}

  .icon-btn{width:46px;height:46px;border-radius:50%;display:inline-grid;place-items:center;background:linear-gradient(180deg,#fff,#fff);border:1px solid rgba(0,0,0,0.04);cursor:pointer;box-shadow:0 6px 18px rgba(10,8,20,0.04);font-size:18px;padding:0}
  .icon-btn.active{background:linear-gradient(180deg,var(--accent),#c97ff2);color:white}

  .glass{height:300px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.88),rgba(255,255,255,0.84));border:1px solid rgba(255,255,255,0.6);position:relative;padding:14px;display:flex;flex-direction:column;align-items:center;overflow:hidden}
  .glass::after{content:'';position:absolute;left:8%;top:6%;width:44%;height:22%;background:linear-gradient(180deg,rgba(255,255,255,0.6),rgba(255,255,255,0.12));transform:skewX(-12deg);border-radius:8px;opacity:0.9}

  .inner-shelf{width:92%;height:170px;background:linear-gradient(180deg,#fffaf0,#fff1e8);border-radius:12px;border:1px dashed rgba(0,0,0,0.04);position:relative;display:flex;align-items:center;justify-content:center;overflow:hidden}

  .slot-wrap{position:relative;margin-top:14px;width:100%;display:flex;justify-content:center}
  .slot{width:86%;max-width:340px;height:42px;background:linear-gradient(180deg,#fff,#fff0);border-radius:12px;box-shadow:inset 0 4px 10px rgba(0,0,0,0.04);display:flex;align-items:center;justify-content:center}
  .slot-inner{width:92%;height:10px;background:linear-gradient(90deg,rgba(0,0,0,0.06),rgba(255,255,255,0.6));border-radius:6px;position:relative}
  .slot-light{position:absolute;left:50%;transform:translateX(-50%);top:-10px;width:0;height:46px;background:radial-gradient(circle at center, rgba(255,255,255,0.95), rgba(215,127,243,0.16));border-radius:50px;opacity:0;pointer-events:none}

  .note{position:absolute;left:50%;transform:translateX(-50%);width:74%;max-width:320px;background:var(--paper);padding:10px 12px;border-radius:12px;box-shadow:0 18px 36px rgba(60,20,60,0.06);font-weight:700;color:#392a44;white-space:pre-wrap;display:flex;gap:8px;align-items:center}
  .emoji{font-size:18px}
  .sticker{font-size:14px;opacity:0.95}

  .floating{animation:floatNote 1600ms cubic-bezier(.28,.85,.45,1.2) forwards}
  @keyframes floatNote{
    0%{top:100%;opacity:0;transform:translate(-50%,40px) scale(.9) rotate(-5deg)}
    30%{opacity:1;transform:translate(-50%,-20px) scale(1.02) rotate(3deg)}
    60%{transform:translate(-50%,0) scale(1) rotate(-2deg)}
    80%{transform:translate(-50%,-8px) scale(1.02) rotate(1deg)}
    100%{top:45%;opacity:1;transform:translate(-50%,0) scale(1) rotate(0deg)}
  }

  .sparkles{position:absolute;left:50%;top:8%;transform:translateX(-50%);pointer-events:none}
  .spark{width:6px;height:6px;border-radius:50%;opacity:0;position:absolute;animation:spark 900ms forwards}
  @keyframes spark{0%{opacity:1;transform:translateY(0) scale(.2)}100%{opacity:0;transform:translateY(-26px) scale(1.1) rotate(180deg)}}

  .meta{color:var(--muted);font-size:13px;margin-top:10px}
  .footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px;color:var(--muted);font-size:13px}

  .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(22,10,30,0.45);backdrop-filter:blur(6px);visibility:hidden;opacity:0;transition:all .18s;z-index:120}
  .modal.show{visibility:visible;opacity:1}
  .modal-card{background:linear-gradient(180deg,#fff,#fff);padding:14px;border-radius:12px;width:92%;max-width:520px}
  .history-list{max-height:320px;overflow:auto;border-radius:8px;padding:8px;background:#fffaf9;border:1px solid #f6f0fb}
  .history-item{padding:8px;border-bottom:1px dashed #f0e9f7;font-weight:700;display:flex;justify-content:space-between;align-items:center}

  @media (max-width:480px){
    .machine{padding:14px;border-radius:14px}
    .glass{height:260px}
    .inner-shelf{height:150px}
    .slot{height:38px}
    .icon-btn{width:42px;height:42px}
    .note{width:82%}
  }
</style>
</head>
<body>
  <!-- INTRO -->
  <div class="intro" id="intro">
    <h1>M√°y b√°n ƒëi·ªÅu t·ªët ƒë·∫πp ‚ú®</h1>
    <p class="intro-guide">M·ªói m·ªôt ƒëi·ªÅu t·ªët ƒë·∫πp ·ªü ƒë√¢y ƒë∆∞·ª£c mua b·∫±ng m·ªôt n·ª• c∆∞·ªùi c·ªßa ch·ªã b√© üíå</p>
    <button class="start-btn" id="startBtn">B·∫Øt ƒë·∫ßu ‚ú®</button>
  </div>

  <div class="animated-bg"></div>
  <div class="stars" id="stars"></div>

  <div class="scene" id="scene">
    <div class="container">
      <div class="machine">
        <div class="top-row">
          <div class="title">M√°y b√°n ƒëi·ªÅu t·ªët ƒë·∫πp</div>
          <div class="controls">
            <button id="historyBtn" title="Xem l·∫°i" class="icon-btn">üíå</button>
            <button id="dispenseBtn" title="Today‚Äôs Good Thing" class="icon-btn active">üåü</button>
            <button id="resetBtn" title="L√†m m·ªõi" class="icon-btn">üîÑ</button>
          </div>
        </div>

        <div class="glass">
          <div class="inner-shelf" id="shelf"></div>
          <div class="slot-wrap">
            <div class="slot">
              <div class="slot-inner"></div>
              <div class="slot-light" id="slotLight"></div>
            </div>
          </div>
        </div>

        <div class="meta">Sau khi r√∫t h·∫øt, ch·ªã b√© s·∫Ω ƒë∆∞·ª£c vi·∫øt 1 mong mu·ªën c·ªßa ri√™ng m√¨nh.</div>
      </div>

      <div class="footer">
        <div>S·ªë l·∫ßn ƒë√£ r√∫t: <strong id="count">0</strong></div>
        <div style="font-size:13px;color:#9a7fb8">Chou Chou ‚ú®</div>
      </div>
    </div>
  </div>

  <!-- modal -->
  <div class="modal" id="modal">
    <div class="modal-card" id="modalCard">
      <h3 id="modalTitle">Vi·∫øt 1 mong mu·ªën c·ªßa ch·ªã b√©</h3>
      <div id="modalBody"></div>
    </div>
  </div>

<script>
/* Hi·ªáu ·ª©ng Intro */
const intro=document.getElementById('intro');
const scene=document.getElementById('scene');
const startBtn=document.getElementById('startBtn');

for(let i=0;i<20;i++){
  const s=document.createElement('div');
  s.className='sparkle';
  s.style.left=Math.random()*100+'%';
  s.style.top=Math.random()*100+'%';
  s.style.animationDelay=(Math.random()*2)+'s';
  intro.appendChild(s);
}

startBtn.addEventListener('click',()=>{
  intro.classList.add('hidden');
  scene.classList.add('visible');
  document.body.style.overflow='auto';
});

/* --- PH·∫¶N CH√çNH C·ª¶A M√ÅY --- */
const notes=["C√≥ th·ªÉ h√¥m nay m·ªát m·ªèi, nh∆∞ng em tin ch·ªã ƒë√£ c·ªë g·∫Øng r·∫•t nhi·ªÅu r·ªìi","Ch·ªâ c·∫ßn ch·ªã c√≤n c·∫£m nh·∫≠n ƒë∆∞·ª£c ch√∫t d·ªãu d√†ng,l√† th·∫ø gi·ªõi n√†y v·∫´n ƒë·∫πp","C·ª© l√†m nh·ªØng g√¨ ch·ªã th√≠ch v√¨ n√≥ l√† t·ª± do","Khi ch·ªã th√≠ch nh·ªØng th·ª© m√¨nh l√†m th√¨ ƒë√≥ l√† h·∫°nh ph√∫c","Tr·ªü v·ªÅ nh√† kh√¥ng c·∫ßn qu√° nhanh ch·ªâ c·∫ßn an to√†n(*)","","Kh√¥ng c·∫ßn ph·∫£i lu√¥n l√† ng∆∞·ªùi l·ªõn, ch·ªâ c·∫ßn v·∫´n l√† ch√≠nh m√¨nh l√† ƒë·ªß","H√£y tin r·∫±ng, d√π m∆∞a hay n·∫Øng, ng√†y mai v·∫´n c√≥ ƒëi·ªÅu t·ªët ƒë·∫πp ch·ªù ƒë·ª£i.","B√†i h√°t n√†y l√† m·ªôt ph·∫ßn em g·ª≠i cho ch·ªã b√©"];
const EMOJI=['üòä','üå∑','‚≠ê','üçÄ','üíñ','‚ú®','üå∏','üåü'];
const STICK=['üéÄ','üåº','üí´','üß°'];
const HISTORY_KEY='goodthing_history_pastel'; const SAVED_KEY='goodthing_custom_pastel';
const shelf=document.getElementById('shelf'); const slotLight=document.getElementById('slotLight');
const btn=document.getElementById('dispenseBtn'); const resetBtn=document.getElementById('resetBtn'); const historyBtn=document.getElementById('historyBtn');
const countEl=document.getElementById('count'); const modal=document.getElementById('modal'); const modalBody=document.getElementById('modalBody');
const bgMusic=document.createElement('audio'); bgMusic.src='song.mp3'; bgMusic.loop=true; document.body.appendChild(bgMusic);
const ting=document.createElement('audio'); ting.src='ting.mp3'; document.body.appendChild(ting);
let dispensed=0; const maxBeforeCustom=notes.length; let history=JSON.parse(localStorage.getItem(HISTORY_KEY)||'[]'); let savedCustom=localStorage.getItem(SAVED_KEY)||'';
let currentNote=null;

function ensureMusic(){ bgMusic.volume=0.18; bgMusic.play().catch(()=>{}); }
document.addEventListener('visibilitychange', ()=>{ if(document.hidden) bgMusic.pause(); else bgMusic.play().catch(()=>{}); });
window.addEventListener('pointerdown', function startOnce(){ ensureMusic(); window.removeEventListener('pointerdown', startOnce); });
function playTing(){ try{ ting.currentTime=0; ting.play(); }catch(e){} }

function makeNoteEl(text){
  const el=document.createElement('div'); el.className='note';
  const emoji=EMOJI[Math.floor(Math.random()*EMOJI.length)];
  const stick=STICK[Math.floor(Math.random()*STICK.length)];
  el.innerHTML=`<div class="emoji">${emoji}</div><div style="flex:1">${text}</div><div class="sticker">${stick}</div>`;
  const sp=document.createElement('div'); sp.className='sparkles'; el.appendChild(sp);
  for(let i=0;i<6;i++){ const spk=document.createElement('div'); spk.className='spark'; spk.style.left=(12+Math.random()*68)+'%'; spk.style.top=(10+Math.random()*70)+'%'; spk.style.background=['#ffd6a5','#fff3b0','#cdecc8','#bcd4ff'][Math.floor(Math.random()*4)]; sp.appendChild(spk);}
  return el;
}

function flashSlot(){
  slotLight.style.transition='none';
  slotLight.style.opacity='0.96'; slotLight.style.width='140%';
  setTimeout(()=>{ slotLight.style.transition='all 700ms ease-out'; slotLight.style.opacity='0'; slotLight.style.width='0%'; },120);
}
function addToHistory(text,type='note'){ const item={text,type,ts:Date.now()}; history.unshift(item); if(history.length>200) history.pop(); localStorage.setItem(HISTORY_KEY,JSON.stringify(history)); }
function updateCount(){ countEl.textContent=dispensed; }

function dispense(){
  ensureMusic();
  // X√≥a note c≈© n·∫øu c√≥
  if(currentNote){ currentNote.remove(); currentNote=null; }

  if(dispensed<maxBeforeCustom){
    btn.disabled=true; flashSlot();
    const text=notes[dispensed]; const el=makeNoteEl(text); shelf.appendChild(el);
    el.style.top='100%'; el.classList.add('floating'); playTing();
    el.querySelectorAll('.spark').forEach((s,i)=>s.style.animationDelay=(i*60)+'ms');
    currentNote=el;
    addToHistory(text,'note'); dispensed++; updateCount();
    btn.disabled=false;
    if(dispensed===maxBeforeCustom){ setTimeout(()=>{ btn.innerText='üíñ Vi·∫øt ƒëi·ªÅu ∆∞·ªõc'; },1800); }
  } else if(dispensed===maxBeforeCustom){ openCustomModal(); }
}

function openCustomModal(){
  modalBody.innerHTML='';
  const area=document.createElement('textarea');
  area.id='wishInput'; area.placeholder='Vi·∫øt ƒëi·ªÅu b·∫°n ∆∞·ªõc...';
  area.style.width='100%'; area.style.height='110px'; area.style.padding='10px';
  area.style.borderRadius='10px'; area.style.border='1px solid #f0e9fb'; area.style.fontSize='15px';
  area.value=savedCustom||'';
  const row=document.createElement('div'); row.style.display='flex'; row.style.gap='10px'; row.style.justifyContent='flex-end'; row.style.marginTop='10px';
  const cancel=document.createElement('button'); cancel.className='icon-btn'; cancel.textContent='H·ªßy'; cancel.style.width='auto'; cancel.style.padding='8px 10px';
  const save=document.createElement('button'); save.className='icon-btn'; save.textContent='L∆∞u & R√∫t'; save.style.width='auto'; save.style.padding='8px 10px'; save.style.background='linear-gradient(180deg,var(--accent),#c97ff2)'; save.style.color='#fff';
  row.appendChild(cancel); row.appendChild(save); modalBody.appendChild(area); modalBody.appendChild(row);
  modal.classList.add('show'); setTimeout(()=>area.focus(),200);
  cancel.addEventListener('click',()=>{ modal.classList.remove('show'); btn.disabled=false; });
  save.addEventListener('click',()=>{
    const text=area.value.trim(); if(!text){ alert('Vui l√≤ng vi·∫øt √≠t nh·∫•t 1 k√Ω t·ª±.'); area.focus(); return; }
    localStorage.setItem(SAVED_KEY,text); savedCustom=text; addToHistory(text,'custom'); modal.classList.remove('show'); dispenseCustom(text);
  });
}

function dispenseCustom(text){
  if(currentNote){ currentNote.remove(); currentNote=null; }
  btn.disabled=true; flashSlot();
  const el=makeNoteEl(text); shelf.appendChild(el); el.style.top='100%'; el.classList.add('floating'); playTing();
  currentNote=el;
  dispensed++; updateCount();
  btn.innerText='B·∫Øt ƒë·∫ßu l·∫°i'; btn.disabled=false;
  btn.removeEventListener('click',onBtn); btn.addEventListener('click',()=>{ resetMachine(); });
}

function resetMachine(){
  if(!confirm('ƒê·∫∑t l·∫°i')) return;
  dispensed=0; updateCount(); shelf.querySelectorAll('.note').forEach(n=>n.remove());
  currentNote=null;
  btn.innerText='üåü'; btn.disabled=false;
  btn.removeEventListener('click',()=>{}); btn.addEventListener('click',onBtn);
}

function openHistory(){
  modalBody.innerHTML='';
  const header=document.createElement('div'); header.style.display='flex'; header.style.justifyContent='space-between'; header.style.alignItems='center'; header.style.marginBottom='8px';
  const hTitle=document.createElement('div'); hTitle.innerText=`L·ªãch s·ª≠ (${history.length})`; hTitle.style.fontWeight='700';
  const clear=document.createElement('button'); clear.className='icon-btn'; clear.textContent='Hi'; clear.style.width='auto'; clear.style.padding='6px 8px';
  header.appendChild(hTitle); header.appendChild(clear); modalBody.appendChild(header);
  const list=document.createElement('div'); list.className='history-list';
  if(history.length===0){ list.innerHTML='<div style="padding:12px;color:#666">Ch∆∞a c√≥ l·ªãch s·ª≠</div>'; }
  history.forEach(it=>{
    const row=document.createElement('div'); row.className='history-item';
    const d=new Date(it.ts);
    row.innerHTML=`<div><span style="margin-right:8px">${it.type==='custom'?'üíå':'üìù'}</span>${it.text}</div><div style="font-size:12px;color:#9a7fb8">${d.toLocaleString()}</div>`;
    list.appendChild(row);
  });
  modalBody.appendChild(list); modal.classList.add('show');
  clear.addEventListener('click',()=>{ if(confirm('X√≥a to√†n b·ªô l·ªãch s·ª≠?')){ history.length=0; localStorage.removeItem(HISTORY_KEY); modal.classList.remove('show'); } });
}

historyBtn.addEventListener('click',()=>{ openHistory(); });
function onBtn(){ dispense(); }
btn.addEventListener('click',onBtn);
resetBtn.addEventListener('click',()=>{ resetMachine(); });
document.getElementById('modal').addEventListener('click',(e)=>{ if(e.target.id==='modal'){ modal.classList.remove('show'); } });
updateCount();
</script>
</body>
</html>
